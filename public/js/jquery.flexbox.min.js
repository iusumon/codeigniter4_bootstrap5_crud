(function(a){a.flexbox=function(b,c){function R(){$curr=K();if($curr&&$curr.prev().length>0){$curr.removeClass(c.selectClass).prev().addClass(c.selectClass);var a=v.attr("scrollTop"),b=$curr[0],d=$curr.parent()[0],e,f,g;if(M()){g=document.getBoxObjectFor(b).height;e=document.getBoxObjectFor(v[0]).y-g*2;f=document.getBoxObjectFor(b).y-document.getBoxObjectFor(v[0]).y}else if(N()){e=d.getBoundingClientRect().top;var h=b.getBoundingClientRect();f=h.top;g=h.bottom-f}if(f<=e)v.attr("scrollTop",a-g)}else if(!$curr)v.children("div:last-child").addClass(c.selectClass)}function Q(){$curr=K();if($curr&&$curr.next().length>0){$curr.removeClass(c.selectClass).next().addClass(c.selectClass);var a=v.attr("scrollTop"),b=$curr[0],d,e,f;if(M()){d=document.getBoxObjectFor(v[0]).y+v.attr("offsetHeight");e=document.getBoxObjectFor(b).y+$curr.attr("offsetHeight");f=document.getBoxObjectFor(b).height}else if(N()){d=v[0].getBoundingClientRect().bottom;var g=b.getBoundingClientRect();e=g.bottom;f=e-g.top}if(e>=d)v.attr("scrollTop",a+f)}else if(!$curr)v.children("div:first-child").addClass(c.selectClass)}function P(){$curr=K();if($curr&&$curr.prev().length>0){$curr.removeClass(c.selectClass);for(var a=0;a<c.maxVisibleRows;a++){if($curr.prev().length>0){$curr=$curr.prev()}}$curr.addClass(c.selectClass);var b=v.attr("scrollTop");v.attr("scrollTop",b-v.height())}else if(!$curr)v.children("div:last-child").addClass(c.selectClass)}function O(){$curr=K();if($curr&&$curr.next().length>0){$curr.removeClass(c.selectClass);for(var a=0;a<c.maxVisibleRows;a++){if($curr.next().length>0){$curr=$curr.next()}}$curr.addClass(c.selectClass);var b=v.attr("scrollTop");v.attr("scrollTop",b+v.height())}else if(!$curr)v.children("div:first-child").addClass(c.selectClass)}function N(){try{document.body.getBoundingClientRect();return true}catch(a){return false}}function M(){try{document.getBoxObjectFor(document.body);return true}catch(a){return false}}function L(){$curr=K();if($curr){m.val($curr.attr("id"));n.val($curr.attr("val")).focus();J();if(c.onSelect){c.onSelect.apply(n[0])}}}function K(){if(!u.is(":visible"))return false;var a=v.children("div."+c.selectClass);if(!a.length)a=false;return a}function J(){n.data("active",false);l.css("z-index",0);u.hide()}function I(a,b){var c=n[0];if(c.createTextRange){var d=c.createTextRange();d.moveStart("character",a);d.moveEnd("character",b-c.value.length);d.select()}else if(c.setSelectionRange){c.setSelectionRange(a,b)}c.focus();return true}function H(b,d){var e=0,f=0;if(!b)return;m.val(n.val());if(parseInt(b[c.totalProperty])===0&&c.noResultsText&&c.noResultsText.length>0){v.addClass(c.noResultsClass).html(c.noResultsText);u.show();return}else v.removeClass(c.noResultsClass);for(var g=0;g<b[c.resultsProperty].length;g++){var h=b[c.resultsProperty][g],i=c.resultTemplate.applyTemplate(h),j=d===i,k=false,l=false,o=h[c.displayValue];if(!j&&c.highlightMatches&&d!==""){var p=d,q=o.toLowerCase().indexOf(d.toLowerCase()),r='<span class="'+c.matchClass+'">'+o.substr(q,d.length)+"</span>";if(i.match("<(.|\n)*?>")){l=true;p="(>)([^<]*?)("+d+")((.|\n)*?)(<)";r='$1$2<span class="'+c.matchClass+'">$3</span>$4$6'}i=i.replace(new RegExp(p,c.highlightMatchesRegExModifier),r)}if(c.autoCompleteFirstMatch&&!l&&g===0){if(d.length>0&&o.toLowerCase().indexOf(d.toLowerCase())===0){n.attr("pq",d);m.val(h[c.hiddenValue]);n.val(h[c.displayValue]);k=I(d.length,n.val().length)}}if(!c.showResults)return;$row=a("<div></div>").attr("id",h[c.hiddenValue]).attr("val",h[c.displayValue]).addClass("row").html(i).appendTo(v);if(j||++f==1&&c.selectFirstMatch||k){$row.addClass(c.selectClass)}e+=i.length}if(e===0){J();return}u.parent().css("z-index",11e3);u.show();v.children("div").mouseover(function(){v.children("div").removeClass(c.selectClass);a(this).addClass(c.selectClass)}).mouseup(function(a){a.preventDefault();a.stopPropagation();L()});if(c.maxVisibleRows>0){var s=$row.outerHeight()*c.maxVisibleRows;v.css("max-height",s)}return e}function G(a,b,d,i,j,k){if(c.maxCacheBytes>0){while(e.length&&g+k>c.maxCacheBytes){var l=e.pop();g-=l.size}var m=a+h+b;f[m]={q:a,p:b,s:d,t:i,size:k,data:j};e.push(m);g+=k}}function F(a,b){var c=a+h+b;if(f[c]){for(var d=0;d<e.length;d++){if(e[d]===c){e.unshift(e.splice(d,1)[0]);return f[c]}}}return false}function E(b,d,e){var f="<<",g="<",h=">",i=">>",k="...";w.addClass(c.paging.cssClass);var m=a("<a/>").attr("href","#").addClass("page").click(D),n=a("<span></span>").addClass("page"),o=l.attr("id");if(d>1){m.clone(true).attr("id",o+"f").attr("page",1).html(f).appendTo(w);m.clone(true).attr("id",o+"p").attr("page",d-1).html(g).appendTo(w)}else{n.clone(true).html(f).appendTo(w);n.clone(true).html(g).appendTo(w)}if(c.paging.style==="links"){var p=c.paging.maxPageLinks;if(b<=p){for(var q=1;q<=b;q++){if(q===d){n.clone(true).html(d).appendTo(w)}else{m.clone(true).attr("page",q).html(q).appendTo(w)}}}else{if(d+parseInt(p/2)>b){startPage=b-p+1}else{startPage=d-parseInt(p/2)}if(startPage>1){m.clone(true).attr("page",startPage-1).html(k).appendTo(w)}else{startPage=1}for(var q=startPage;q<startPage+p;q++){if(q===d){n.clone(true).html(q).appendTo(w)}else{m.clone(true).attr("page",q).html(q).appendTo(w)}}if(b>startPage+p){m.clone(true).attr("page",q).html(k).appendTo(w)}}}else if(c.paging.style==="input"){var r=a("<input/>").addClass("box").click(function(a){this.select()}).keypress(function(a){return C(a,this.value,b)}).val(d).appendTo(w)}if(d<b){m.clone(true).attr("id",o+"n").attr("page",+d+1).html(h).appendTo(w);m.clone(true).attr("id",o+"l").attr("page",b).html(i).appendTo(w)}else{n.clone(true).html(h).appendTo(w);n.clone(true).html(i).appendTo(w)}var s=(d-1)*j+1;var t=s>e-j?e:s+j-1;if(c.paging.showSummary){var u={start:s,end:t,total:e,page:d,pages:b};var v=c.paging.summaryTemplate.applyTemplate(u);a("<br/>").appendTo(w);a("<span></span>").addClass(c.paging.summaryClass).html(v).appendTo(w)}}function D(b){z(parseInt(a(this).attr("page")),true,n.attr("pq"));return false}function C(b,c,d){if(/^13$|^39$|^37$/.test(b.keyCode)){if(b.preventDefault)b.preventDefault();if(b.stopPropagation)b.stopPropagation();b.cancelBubble=true;b.returnValue=false;switch(b.keyCode){case 13:if(/^\d+$/.test(c)&&c>0&&c<=d)z(c,true);else alert("Please enter a page number between 1 and "+d);break;case 39:a("#"+l.attr("id")+"n").click();break;case 37:a("#"+l.attr("id")+"p").click();break}}}function B(a,b){w.html("").removeClass(c.paging.cssClass);if(c.showResults&&c.paging&&b>j){var d=b/j;if(b%j>0)d=parseInt(++d);E(d,a,b)}}function A(a,b){var d={};d[c.resultsProperty]=[];d[c.totalProperty]=0;var e=0;for(var f=0;f<a[c.resultsProperty].length;f++){var g=a[c.resultsProperty][f][c.displayValue].toLowerCase().indexOf(b.q.toLowerCase());if(c.matchAny&&g!==-1||!c.matchAny&&g===0){d[c.resultsProperty][e++]=a[c.resultsProperty][f];d[c.totalProperty]+=1}}if(c.paging){var h=(b.p-1)*b.s;var i=h+b.s>d[c.totalProperty]?d[c.totalProperty]-h:b.s;d[c.resultsProperty]=d[c.resultsProperty].splice(h,i)}return d}function z(b,d,e){if(d)e="";var f=e&&e.length>0?e:a.trim(n.val());if(f.length>=c.minChars||d){if(v.outerHeight()>0)v.css("height",v.outerHeight());v.html("").attr("scrollTop",0);var g=F(f,b);if(g&&!d&&c.selectBehavior||g&&!c.selectBehavior){v.css("height","auto");H(g.data,f);B(b,g.t)}else{var h=f;if(c.selectBehavior)h="";if(c.parentObject!=null){var i=a(c.parentObject).val();var l={q:h,p:b,v:i,s:j,contentType:"application/json; charset=utf-8"}}else var l={q:h,p:b,s:j,contentType:"application/json; charset=utf-8"};var m=function(a,d){if(d===true)f=d;var e=parseInt(a[c.totalProperty]);if(isNaN(e)&&c.paging){if(c.maxCacheBytes<=0)alert('The "maxCacheBytes" configuration option must be greater\nthan zero when implementing client-side paging.');e=a[c.resultsProperty].length;var g=e/j;if(e%j>0)g=parseInt(++g);for(var h=1;h<=g;h++){var i={};i[c.totalProperty]=e;i[c.resultsProperty]=a[c.resultsProperty].splice(0,j);if(h===1)l=H(i,f);G(f,h,j,e,i,l)}}else{var l=H(a,f);G(f,b,j,e,a,l)}B(b,e);v.css("height","auto");k=false};if(typeof c.source==="object"){if((!c.allowInput||c.selectBehavior)&&d)m(c.source);else m(A(c.source,l))}else{k=true;if(c.method.toUpperCase()=="POST")a.post(c.source,l,m,"json");else a.getJSON(c.source,l,m)}}}else J()}function y(a,b){if(d)clearTimeout(d);var e=b?c.queryDelay*5:c.queryDelay;d=setTimeout(function(){z(1,a,"")},e)}function x(b){var d=0;if(typeof b.ctrlKey!=="undefined"){if(b.ctrlKey)d|=1;if(b.shiftKey)d|=2}else{if(b.modifiers&Event.CONTROL_MASK)d|=1;if(b.modifiers&Event.SHIFT_MASK)d|=2}if(/16$|17$/.test(b.keyCode))return;var e=b.keyCode===9,f=b.keyCode===27;var g=b.keyCode===9&&d>0;var h=b.keyCode===8;if(e)if(K())L();if(/27$|38$|33$|34$/.test(b.keyCode)&&u.is(":visible")||/13$|40$/.test(b.keyCode)||!c.allowInput){if(b.preventDefault)b.preventDefault();if(b.stopPropagation)b.stopPropagation();b.cancelBubble=true;b.returnValue=false;switch(b.keyCode){case 38:R();break;case 40:if(u.is(":visible"))Q();else y(true);break;case 13:if(K())L();else y(true);break;case 27:J();break;case 34:if(!k){if(c.paging)a("#"+l.attr("id")+"n").click();else O()}break;case 33:if(!k){if(c.paging)a("#"+l.attr("id")+"p").click();else P()}break;default:if(!c.allowInput){return}}}else if(!f&&!e&&!g){y(false,h)}}var d=false,e=[],f=[],g=0,h="â—Š",i=false,j=c.paging&&c.paging.pageSize?c.paging.pageSize:0,k=false,l=a(b).css("position","relative").css("z-index",0);var m=a('<input type="hidden"/>').attr("id",l.attr("id")+"_hidden").attr("name",l.attr("id")).val(c.initialValue).appendTo(l);var n=a("<input/>").attr("id",l.attr("id")+"_input").attr("autocomplete","off").addClass(c.inputClass).css("width",c.width+"px").appendTo(l).click(function(a){if(c.watermark!==""&&this.value===c.watermark)this.value="";else this.select()}).focus(function(b){a(this).removeClass("watermark")}).blur(function(a){if(this.value==="")m.val("");setTimeout(function(){if(!n.data("active"))J()},200)}).keydown(x);if(c.initialValue!=="")n.val(c.initialValue).removeClass("watermark");else n.val(c.watermark).addClass("watermark");var o=0;if(c.showArrow&&c.showResults){var p=function(){if(u.is(":visible")){J()}else{n.focus();if(c.watermark!==""&&n.val()===c.watermark)n.val("");else n.select();if(d)clearTimeout(d);d=setTimeout(function(){z(1,true,c.arrowQuery)},c.queryDelay)}};var q=a("<span></span>").attr("id",l.attr("id")+"_arrow").addClass(c.arrowClass).addClass("out").hover(function(){a(this).removeClass("out").addClass("over")},function(){a(this).removeClass("over").addClass("out")}).mousedown(function(){a(this).removeClass("over").addClass("active")}).mouseup(function(){a(this).removeClass("active").addClass("over")}).click(p).appendTo(l);o=q.width();n.css("width",c.width-o+"px")}if(!c.allowInput){c.selectFirstMatch=false;n.click(p)}var r=n.outerHeight()-n.height()-2;var s=n.outerWidth()-2;var t=n.outerHeight();if(r===0){s+=4;t+=4}else if(r!==4){s+=r;t+=r}var u=a("<div></div>").attr("id",l.attr("id")+"_ctr").css("width",s+o).css("top",t).css("left",0).addClass(c.containerClass).appendTo(l).mousedown(function(a){n.data("active",true)}).hide();var v=a("<div></div>").addClass(c.contentClass).appendTo(u).scroll(function(){i=true});var w=a("<div></div>").appendTo(u);l.css("height",n.outerHeight());String.prototype.applyTemplate=function(a){try{if(a==="")return this;return this.replace(/{([^{}]*)}/g,function(b,c){var d;if(c.indexOf(".")!==-1){var e=c.split(".");var f=a;for(var g=0;g<e.length;g++)f=f[e[g]];d=f}else d=a[c];if(typeof d==="string"||typeof d==="number")return d;else throw b})}catch(b){alert("Invalid JSON property "+b+" found when trying to apply resultTemplate or paging.summaryTemplate.\nPlease check your spelling and try again.")}}};a.fn.flexbox=function(b,c){if(!b)return;try{var d=a.fn.flexbox.defaults;var e=a.extend({},d,c);for(var f in e){if(d[f]===undefined)throw"Invalid option specified: "+f+"\nPlease check your spelling and try again."}e.source=b;if(c){e.paging=c.paging||c.paging==null?a.extend({},d.paging,c.paging):false;for(var f in e.paging){if(d.paging[f]===undefined)throw"Invalid option specified: "+f+"\nPlease check your spelling and try again."}if(c.displayValue&&!c.hiddenValue){e.hiddenValue=c.displayValue}}this.each(function(){new a.flexbox(this,e)});return this}catch(g){if(typeof g==="object")alert(g.message);else alert(g)}};a.fn.flexbox.defaults={method:"GET",queryDelay:100,allowInput:true,containerClass:"ffb",contentClass:"content",selectClass:"ffb-sel",inputClass:"ffb-input",arrowClass:"ffb-arrow",matchClass:"ffb-match",noResultsText:"No matching results",noResultsClass:"ffb-no-results",showResults:true,selectFirstMatch:true,autoCompleteFirstMatch:false,highlightMatches:true,highlightMatchesRegExModifier:"i",matchAny:true,minChars:1,showArrow:true,arrowQuery:"",onSelect:false,maxCacheBytes:32768,resultTemplate:"{name}",displayValue:"name",hiddenValue:"id",initialValue:"",watermark:"",width:200,resultsProperty:"results",totalProperty:"total",parentObject:null,selectBehavior:false,maxVisibleRows:0,paging:{style:"input",cssClass:"paging",pageSize:10,maxPageLinks:5,showSummary:true,summaryClass:"summary",summaryTemplate:"Displaying {start}-{end} of {total} results"}};a.fn.setValue=function(b){var c="#"+this.attr("id");a(c+"_hidden,"+c+"_input").val(b).removeClass("watermark")}})(jQuery)